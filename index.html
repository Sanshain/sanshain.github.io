<!DOCTYPE html>
<html lang="">

	<head>

		<meta charset="utf-8">

      <link rel="stylesheet" href="slider.css">


		<script>

         vom = {};
			vom.add = function(container, elem, cls){
			
				if (typeof container == 'string') 	{	
					container = document.querySelector(container);
					}
				if (typeof elem == 'string'){
					
					elem = document.createElement(elem);
					if (cls) elem.className = cls;
					
				}
				
				container.appendChild(elem);
				
				return elem;		
			};

			function Elem(type_name, txt, css_cls){		
				var elem = document.createElement(type_name);	
				elem.innerText = txt;	//value
				
				if (css_cls) {
					elem.className = css_cls;
				}
				
				return elem;	
			}














         /*!
			    Поменять имена на более читабельные
				 Пожалуй, на этом все
			
			*/


         var slider = {
			    

				back : true,
				btn__next : true,		
            slide_id_prefix : 'slide_',
				get_nextsource : function (_src_elem, _next_){
				 
					while(_src_elem){

						_src_elem = _src_elem[_next_];
					  
						if (_src_elem && _src_elem.src) {
						
							 return _src_elem;
						}
					}							 

					return null;
				 
				},				
				arrowAssing_for : function (_src_elem, _next){
				   
					if (typeof _next == typeof true){
					    
						 _flag = _next;
						 _next = _next 
						     ? 'nextSibling'
							  : 'previousSibling';
					}
					else if(_next == void 0){
					    
						 this.__ae = true;
						 
						 this.arrowAssing_for(_src_elem, true);
						 this.arrowAssing_for(_src_elem, false);
						 
						 this.__ae = false;
						 
						 return;
							  
					}
					else _flag = _next == 'nextSibling';
				  
					var mover 
					  = _flag ? 'btn__next' : 'back';
					  
					var un_mover 
					  = !_flag ? 'btn__next' : 'back';
					  
					// если возврат выкл, включаем
					if (!this.__ae && !slider[un_mover]) {

						move_enable(un_mover);
					}
					
					//если след эл-та нет, выкл кнопку
					if (!slider.get_nextsource(
						 _src_elem, 
						 _next)) 
					{
						  mover_disable(mover);
						  return false;
					}
					else if (!slider[mover]) move_enable(mover);

               return true;
										  
				},			
				init : function(elem){
				
				   var img_source_id = elem.id;
					
					if (!img_source_id)
					    throw new Error('Не задан id для источника слайдера');
	
					var num = 
					    (img_source_id.match(/\d+/)||[]).pop();
					 
					if (num == void 0)
							 throw new Error('id источника не содержит цифр');					 
					 
					this.source_id_prefix = 
					    img_source_id.slice(
						     0, -String(num).length
						 );
						 
						 
					load_slide_by(elem, true);
					
					
					
					var _slider = document.querySelector(
						'.slide_container'
					);					
					
					_slider.style.display = 'block';
					
					setTimeout(function (){
					    
						_slider.style.opacity = '1';
					},25);
						 
				},
				/*!
				    slide_id - id текущего слайда  
					 flag - флаг направления:
					     true - вперед
					     false - назад
					     undefined - текущий (первый запуск)
				    
				    image_load - возвращает id и src для 
					     текущего слайда либо false, если больше слайдов нет
					 
				*/
				image_load : function (slide_id, flag){
				    
					 
					// demo: 
					/*
					if (flag == void 0)
						return {
							src : slide_id 
								? 'back.jpg'
								: 'sample.png',
							id : 'default'
						};						//*/  
					 

					 
					 // practic:	 
					 
                if (flag != void 0){
					    //если задано направление
					 
					 
						 var num = slide_id.match(/\d+/).pop();
						 
						 var src_elem = document.getElementById(
							  this.source_id_prefix + num
					    );					 
					 
					 
						 //теперь нужно найти смежный элемент
						 //Если num идут по порядку, то просто +-num
						 //Если элементы имеют общего root, то
						 
						 
						 
						 var next = flag 
							  ? 'nextSibling' 
							  : 'previousSibling';
						 

						 
						src_elem = slider.get_nextsource(
						     src_elem,
							  next
						);
						 
						 
                   if (!src_elem) return false;

					 }					 
					 else{
					     
						  // если не задано, то init
						  
						  src_elem = document.getElementById(
						      slide_id
						  );
						  
						  slider.arrowAssing_for(src_elem, next);
						  
					 }

					 
					 if (src_elem && src_elem.id){
					   
						var num = src_elem.id.match(/\d+/).pop();			
						src_elem.focus();
						
						return {
						    id : this.slide_id_prefix + num, 
							 src : src_elem.src
						} ;
						
					 }
					 else return false;
					 
                
				},
				__ontouch : function (elem){
				
				},
				onswipe : function (){
				
				}
			}

         

         function image_expand(){			   
			 
				var slide= document.querySelector('.slide');

				var fullOnScreen = slide.requestFullScreen
				  || slide.webkitRequestFullScreen
				  || slide.mozRequestFullScreen
				  || slide.msRequestFullScreen;

				if (fullOnScreen) fullOnScreen.call(slide);
				
			}
			
			// load_slide_by();
			
			/*!
			    \brief: need for override and by slider load 
				 
				 current - текущий слайд (либо для выбора 
				     направления, если фото уже предзагружены)
					  Элемент с классом .image_container
 
				 flag - направление (нужно для выбора след фото)
				 
				 current && flag => init
				 current && !flag => back
				 !current && !flag => next
				 
			*/
			var load_slide_by = function(current, flag){
			
				// здесь возможна предзагрузка
				
				if (!current){
				
				   var slides = document.querySelectorAll(
					    '.image_container'
					);
					
				   var cur_id =
					    slides[0].style.marginLeft.slice(1,-3);
				
				
				   cur_id = cur_id || 0;
					 
					var _cur = slides[cur_id];
				
					var _next = (_cur || {}).nextSibling;
						 
					if (_next){						
						
						return true; // если он есть, то true
					}               
					//else continue next code executing:
					//for load img				
					
				 
				}
				

				// для swipe:
				var i_s = slider.image_load(
				    (current || _cur).id,
					 (current && flag) 
					     ? (void 0)                 // init
						  : !current ? true : false  // next:back
				);
				
				if (!i_s) return false;				
				
				if (current && !flag){               // back
				
				   // добавляем новый контейнер в начало
				
				    var slide_leaf = 
					     Elem('div','', 'image_container');
					 
					 slide_leaf.style.marginLeft = '-100%';
					 
					 var parent = current.parentElement;
					 
					 parent.insertBefore(slide_leaf, current);
					 
				}
				else if (flag || flag == void 0){             					
					// init || next
					
					// добавляем новый контейнер в конец
					
					var slide_leaf = vom.add(
						  '.slide_container',
						  'div',
						  'image_container');
						  
					
				}
				
				var slide = vom.add(slide_leaf,'img','slide');
							
				slide.src = i_s.src;
				slide_leaf.id = i_s.id;
				
				slide.ondragstart = () => { return false;}
				
				var swipe_offset = 0;
				var swipped  = false;
				var start_off__px = 0;
				var start_off__perc = 0;
				var tuner = null;
				
				
				
				
				try
				{
				
				   slide_leaf.addEventListener(
					     'touchstart', () => {alert(0)}
					);
				   slide_leaf.addEventListener(
					     'touchend', () => {alert(2)}
					);
																
				}
				catch(err){
				
				   alert(1);
					
				}				
				
				slide_leaf.onmousedown  = function (event){
				    
					 swipe_offset = event.screenX;
					 console.log('d'+event.screenX);
					 
					 swipped = true;
					 
					 
                tuner = document.querySelector(
					     '.image_container'
					 ); 

					 // надо сначала получить в px:
					 /*
					 var cv = window.getComputedStyle(
					     tuner
						  
					 ).marginLeft;					 
					 
                start_off__px = Number.parseInt(cv);//*/
					 
					 
					 // а здесь надо получить в %:
					 
					 var _cv = tuner.style.marginLeft;
					 
					 _cv = _cv ? Number.parseInt(_cv) : 0;
					 
					 start_off__perc = _cv;
					 
				};
				slide_leaf.onmouseup  = function (event){
				    
					 swipe_offset = swipe_offset - event.screenX;
					 
					 console.log(event.screenX);
					 console.log('off: '+swipe_offset);
					 
					 if (swipped && tuner){
					 
					     if (Math.abs(swipe_offset) > 50){
						      
								
								//var sgn = Math.sign(swipe_offset);
								//if (!sgn) return;//*/
								
								if (swipe_offset > 0) next_slide();
								else {
								    
									 back_slide();
								}
								
								
								/*
								tuner.style.marginLeft = 
								    (start_off__perc - sgn*100)+'%';
									 
								// + добавляем новую картинку*/
						  }
					 }
					 
					 swipped = false;
					 tuner = null;
					 
					 swipe_offset = 0;
				};
				slide_leaf.onmousemove  = function (event){
				    
					 if (!swipped || !tuner) return;
					 
					 _swipe_offset= swipe_offset - event.screenX;

					 /* выключил, потому что долго:
					 
					 cv = (start_off__px-_swipe_offset) + 'px';
					 
					 console.log(cv);
					 
					 tuner.style.marginLeft = cv;
	
//					 if (swipe_offset)*/
					 
				};	
				
				//if ('ontouchstart' in window) {
				
				   

				
            return true;				
			}
			
			
			
			var move_slide = function(vector){
			
			   vector = vector || 1;
			
			   var current= 
				   document.querySelector('.image_container');
				
            slider.arrowAssing_for(current, !!(1+vector));
								
				var margin_offset = current.style.marginLeft;
				
				var addend = 
				    Number.parseInt(margin_offset) || 0;
				
				var margin_value = addend - (vector)*100;
				
				if (margin_value > 0) {
				
   				return false;
				}
				
				current.style.marginLeft = margin_value + '%';
				
				return true;
				
			}
			
			
			function next_slide(){
			
			   if (load_slide_by()){
				
				    move_slide();
					 
					 if (!slider.back)
					     move_enable(
						      document.querySelector('.back')
						  );
				}
            else{
				
				}
					
			}

         function back_slide(btn) {
			    if (!move_slide(-1)){
				 
						var current= 
							document.querySelector(  
							    '.image_container'
						   );
				     
				     if (load_slide_by(current)) {
					      
                     setTimeout(function(){
							    
								 move_slide(-1);						
							}, 10);							
					  }
					  
					  else mover_disable(btn)
					  
				 }
			}
			
			
			function mover_disable(btn){
			   
				if (typeof btn == typeof ''){
				    
					btn = document.querySelector('.'+btn);
				}
				
            slider[btn.className] = false;
				btn.style.display = 'none';
			}
			
			function move_enable(btn){
			   
				if (typeof btn == typeof ''){
				    
					btn = document.querySelector('.'+btn);
				}				
				
            slider[btn.className] = true;
				btn.style.display = 'block';
			}			

         function slider_close(){
			    
				 var _slider = document.querySelector(
				     '.slide_container'
				 );
				 
				 _slider.style.opacity = '0';
				 
				 setTimeout(function(){
				     
					_slider.style.display = 'none';
					
					
					
					//clean:
					var slides = _slider.querySelectorAll(
					    '.image_container'
				   );

               
					var i = slides.length; while(--i >= 0) {
					
						 _slider.removeChild(slides[i]);
					};	
					
				 }, 1000);
			}


		</script>

	</head>

	<body>
	
	   <img src="sample.png" alt="" id="src_1" 
		    onclick=slider.init(this)
		    height=50
			 width=100 />
	   <img src="back.jpg" alt="" id="src_2" 
		    onclick=slider.init(this)
		    height=50
			 width=100 />			 
	
		<div class="slide_container">
				   
			<button class="expand" onclick='image_expand()'>
			    <span class="t"></span>
			    <span class="r"></span>
			    <span class="l"></span>
			    <span class="b"></span>
			</button>
					
			<div class="back" onclick='back_slide(this)'>

				<div class="arrow up"></div>
				<div class="arrow down"></div>

			</div>




<!--
         <div class="image_container" id='prime_slide'>
			    <img class="slide" src="sample.png" alt="">	
			</div>			
-->
			
			<div class="btn__next" onclick='next_slide(this)'>
					
				<div class="arrow up"></div>
				<div class="arrow down"></div>
						
			</div>
			
			
			
	      <div class="slides">
			    <a href="">...</a>
			    <a href="">1</a>
			    <a href="">2</a>
				 <span>12</span>
			    <a disabled href="">3</a>
			    <a href="">4</a>
			    <a href="">...</a>
			</div>			
			
			<button class="close" onclick='slider_close()'>
			    <span class="c__right"></span>
			    <span class="c___back"></span>			    
			</button>			
			
		</div>
		


	</body>

</html>